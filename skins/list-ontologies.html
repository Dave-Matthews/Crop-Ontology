<script>
$(function(){

function filterCat(cat) {
    // if the first word contains a dash - good enough
    var words = cat.split(" "),
        firstWord = words[0];

    var containsDash = firstWord.split("-").length;

    if(containsDash)
        return cat.replace(firstWord, "");
    else
        return cat;

}
function addRow(obj, par) {
    var $row = $(".row:first").clone();

    $row.show();


    // replace stuff

    // replace slasehs with dashes because then url goes crazy
    var escapedName = obj.ontology_name.replace("/", "-");

    $row.find("h3 a.term").attr("title", obj.ontology_name)
                .attr("href", "/ontology/"+obj.ontology_id+"/"+escapedName)
                .text(obj.ontology_name);


    $row.find(".comments_rss")
                .attr("href", "/ontology/"+obj.ontology_id+"/"+escapedName+"/rss");

    $row.find("a.username").click(function(e) {
        UserWidget.show(obj.userid);
        
        e.preventDefault();
        e.stopPropagation();
    }).text(obj.username);

    $row.find("p span.description").text(obj.ontology_summary);

    par.append($row);
}

// we don't want to get all ontologies,
// get all categories first and then fetch
// the ontology for each specific category
var cont = $(".list-ontologies .bar");

// create 2 containers, left and right
var left = $("<div class='bar'></div>"),
    right = $("<div class='bar'></div>");

$(".list-ontologies").append(left).append(right);
    

$.getJSON("/get-categories", function(cats) {
    for(var i=0, len=cats.length; i<len; i++) {
        var c = cont.clone();



        c.find(".featured-heading span").text(filterCat(cats[i]));
        c.get(0).className = "";

        if(i%2) // is odd, add to right
            right.append(c);
        else
            left.append(c);

        c.show();

        // now load the ontologies for this category
        // hrm seems like "c" isn't carried on
        (function(c) {
            $.getJSON("/ontologies", {category: cats[i]}, function(json) {
                $.each(json, function() {
                    addRow(this, c);
                });
                c.find(".loader").hide();

            });
        })(c);
    }

});


});

</script>
 

 <a href="/latest" class="button" style="display: inline">Latest</a>
 
            <div class="list-ontologies"> 
                <div class="bar left" style="display: none;">
                    <h2 class="featured-heading"><span>Crop Ontologies</span></h2>
                    <img src="/images/metabox_loader.gif" class="loader"/>

                    <ol class="ranked-repositories row" style="display: none;">
                        <li>
                            <a href="#" title="Comments RSS" class="comments_rss"></a>
                            <h3>
                                <a title="AccessionLocalUniqueIdentifier" class="term" href="/data-dictionary/AccessionLocalUniqueIdentifier">AccessionLocalUniqueIdentifier</a><a href="#" class="username">Ciao</a>
                            </h3>
                            <p class="description"><span class="description">Here's a test of an ontology</span> </p>
                        </li>
                    </ol>
                </div>
            </div><!-- end list-onto --> 

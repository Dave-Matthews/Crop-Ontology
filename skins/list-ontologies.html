<script>
$(function(){

// we don't want to get all ontologies,
// get all categories first and then fetch
// the ontology for each specific category
var cont = $(".list-ontologies .bar");
$.getJSON("/get-categories", function(cats) {
    for(var i=0; i<cats.length; i++) {
        var c = cont.clone();

        c.find(".featured-heading span").text(cats[i]);

        $(".list-ontologies").append(c);
        c.show();

        // now load the ontologies for this category
        $.getJSON("/ontologies", {category: cats[i]}, function(json) {
            $.each(json, function() {
                addRow(this, c);
            });
            c.find(".loader").hide();

        });
    }

});


function addRow(obj, parent) {
    var $row = $(".row:first").clone();

    $row.show();


    // replace stuff
    $row.find("h3 a.term").attr("title", obj.ontology_name)
                .attr("href", "/ontology/"+obj.ontology_id)
                .text(obj.ontology_name);
    $row.find("a.username").text(obj.username);

    $row.find("p span.description").text(obj.ontology_summary);

    parent.append($row);
}
/*
var url = "/ontologies",
    parent = $(".list-ontologies .bar");

$.getJSON(url, function(json) {
    $.each(json, function() {

    });
    $(".loader").hide();

});
*/

});

</script>
 
 
            <div class="list-ontologies"> 
                <div class="bar left" style="display: none;">
                    <h2 class="featured-heading"><a class="feed" href="http://singerdatadictionary.disqus.com/latest.rss">Subscribe</a><span>Crop Ontologies</span></h2>
                    <img src="/images/metabox_loader.gif" class="loader"/>

                    <ol class="ranked-repositories row" style="display: none;">
                        <li>
                            <ul class="repo-stats">
                                <li class="watchers">
                                    <a title="Comments" href="http://singer.cgiar.org/data-dictionary/AccessionLocalUniqueIdentifier#disqus_thread">0</a>    
                                </li>
                            </ul>
                            <h3>
                                <a title="AccessionLocalUniqueIdentifier" class="term" href="/data-dictionary/AccessionLocalUniqueIdentifier">AccessionLocalUniqueIdentifier</a><a href="#" class="username">Ciao</a>
                            </h3>
                            <p class="description"><span class="description">Here's a test of an ontology</span> </p>
                        </li>
                    </ol>
                </div>
            </div><!-- end list-onto --> 
